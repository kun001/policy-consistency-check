# 政策文件对比分析（前端交互与设计范式）

本文档描述“政策文件对比分析”页面的前端交互逻辑与设计范式，聚焦 UI/状态管理/数据渲染约定，便于与后端接口对接。仅覆盖前端需要的内容。

## 1. 目标与范围
- 目标：支持“一对多”对比，用户选择一个地方政策文件，对比多个国家政策文件。
- 展示：按地方政策的“条款”为粒度展示对比结果；不展示目录树，采用列表样式。
- 交互：左侧为可折叠条款列表；默认仅显示“存在差异”的条款，且仅展示前4条；展开条款显示全文，右侧同时更新对应国家条款摘要与 AI 分析。
- 约束：左右两栏高度统一，限制过长；内部滚动以保持页面干净整洁。

## 2. 用户交互流程
1. 在工具栏选择：单选“地方政策文件” → 多选“国家政策文件”。
2. 点击“生成对比结果”，页面根据接口返回渲染左右两栏内容。
3. 左侧浏览地方条款列表（默认只显示差异条款，最多5条，可展开更多或显示全部）。
4. 点击某条地方条款，右侧同步展示对应的国家条款摘要，并在底部展示 AI 分析结果。

## 3. 布局规范
- 顶部工具栏：
  - 单选下拉：地方政策文件。
  - 多选下拉：国家政策文件（可多选）。
  - 开关：只看差异（默认开启）。
  - 统计：已选国家政策数量提示（Tag）。
  - 按钮：生成对比结果。
- 主视图区（两栏并排）：
  - 左栏（地方政策条款列表，折叠面板）：
    - 条目显示：标题 + 状态 Tag（存在差异/无差异）+ 差异摘要；展开后显示地方条款全文。
    - 默认仅显示“存在差异”，并且最多展示 4 条；支持“展开更多”（每次 +6）与“显示全部条款”。
    - 展开某条款时，右栏联动更新并滚动置顶。
  - 右栏（国家政策映射 + AI 分析）：
    - 顶部：选中地方条款的摘要。
    - 中部：按所选国家政策逐个显示匹配的国家条款（标题+摘要）；若未匹配则显示空态提示。
    - 底部：AI 分析结论（文本）。
- 高度与滚动：
  - 两栏统一高度：`calc(100vh - 260px)`（含工具栏后可视区），各自内部滚动。
  - 点击左侧条目时，右栏滚动置顶以便快速查看内容。

## 4. 组件与状态（以 PolicyCompare 为例）
- 组件：`PolicyCompare`
- 主要状态：
  - `localDoc`: 单选地方政策对象 `{ value, label }`。
  - `nationalDocs`: 多选国家政策对象数组 `[{ value, label }, ...]`。
  - `showOnlyDiff`: 是否仅显示存在差异（默认 `true`）。
  - `visibleCount`: 列表可见条目数（默认 `4`）。
  - `compareResults`: 对比结果数组（按地方条款粒度）。
  - `selectedClauseId`: 当前选中的地方条款 ID。
  - `expandedKeys`: 左侧折叠面板的展开项 `string[]`，用于联动右栏。
  - `rightPanelRef`: 右栏滚动控制。
- 派生数据：
  - `filteredClauses`: 基于 `showOnlyDiff` 过滤并基于 `visibleCount` 截断后的列表。
  - `selectedClause`: 当前选中的地方条款对象。
- 事件处理：
  - `handleGenerate()`: 调用接口获取对比结果，初始化 `compareResults`、`selectedClauseId`、`visibleCount`。
  - 折叠展开：折叠面板 `onChange(keys)` 更新 `expandedKeys`，并同步 `selectedClauseId` 与右栏置顶。
  - 展开更多/显示全部：`visibleCount += 6`；或切换 `showOnlyDiff` 为 `false` 展示全部。

## 5. 数据模型与接口契约（前端视角）
- 选择项：
  - 地方政策：`{ value: string, label: string }`
  - 国家政策：`{ value: string, label: string }[]`
- 对比结果（按地方条款粒度返回）：
```json
[
  {
    "id": "L-001",
    "title": "地方条款标题",
    "hasDiff": true,
    "diffSummary": "差异概述（简短摘要）",
    "localExcerpt": "地方条款摘要（若正文很长，仅返回关键摘要）",
    "matchedNational": [
      {
        "docId": "nat-001",
        "clauseId": "nat-001-C1",
        "title": "国家条款标题",
        "excerpt": "国家条款摘要"
      }
      // 可包含多个，分别对应多选的国家政策文件
    ],
    "analysis": "AI 分析文本（对差异的解释、建议、对齐方案等）"
  }
]
```
- 请求示例（建议，实际以后端为准）：
```json
{
  "local": { "value": "loc-001" },
  "nationals": [ { "value": "nat-001" }, { "value": "nat-002" } ]
}
```
- 返回示例：如上“对比结果”数组。

## 6. 渲染与筛选逻辑
- 初始：未选择或未生成对比结果时，展示空态提示。
- 过滤：`showOnlyDiff === true` 时仅保留 `hasDiff === true` 的条款。
- 截断：根据 `visibleCount` 控制可见条目数，默认 4 条。
- 展开更多：`visibleCount += 6`；也可直接一次性展示全部。
- 显示全部条款：`showOnlyDiff = false`（可恢复为只看差异）。
- 折叠展开或切换选中：更新 `selectedClauseId`，右栏同步刷新对应内容并滚动置顶。

## 7. 空态 / 加载 / 错误态
- 空态：
  - 未选择文档或未生成结果时，显示“请选择并生成对比结果”。
  - 右栏未选条款时，提示“点击左侧存在差异的地方条款…”。
  - 单个国家政策未匹配时，在对应卡片显示“未找到与该地方条款对应的国家条款”。
- 加载态：
  - 生成对比结果期间可展示 `Spin` 或 `Skeleton`（建议）。
- 错误态：
  - 接口失败或超时，展示 `message.error` 并保留当前状态。

## 8. 视觉与样式
- 组件：Ant Design（`Card`、`Collapse`、`Tag`、`Select`、`Switch`、`Button`、`Divider` 等）。
- 标签：
  - 差异：`<Tag color="red">存在差异</Tag>`
  - 无差异：`<Tag>无差异</Tag>`
  - 已选统计：`<Tag color="blue">已选国家政策：N 个</Tag>`
- 高度：
  - 两栏统一：`height: calc(100vh - 260px)`；`overflow-y: auto` 内部滚动。
- 文案：与页面中文一致，避免冗长内容，摘要优先。

## 9. 可扩展性建议
- 长列表优化：对大量条款使用虚拟列表（如 `rc-virtual-list` 或自定义虚拟化）。
- 精确定位：右栏可对匹配的国家条款设置锚点 `id`，支持定位与高亮。
- 悬浮对比：可提供“并排比对”模式下的高亮差异（新增/删除/修改）。
- 导出能力：后续支持导出 PDF/Markdown/JSON（按钮预留）。

## 10. 验收要点
- 能选择 1 个地方政策 + 多个国家政策，且能生成对比结果。
- 左栏为折叠面板，默认仅显示差异条款，最多 4 条；可展开条款全文或显示全部。
- 展开或选择左栏条款后，右栏正确展示对应国家条款摘要与 AI 分析，并滚动置顶。
- 两栏高度统一、版面不冗长，滚动体验顺畅。
- 在空态/错误态时有清晰反馈。